# --- Show image preview on the left ---
with col_img:
    if uploaded_file is not None:
        st.subheader("ğŸ–¼ Uploaded Image Preview")
        try:
            with rasterio.open(raster_path) as src:
                bands_to_show = min(3, src.count)
                img_array = src.read(list(range(1, bands_to_show+1)))
                img_array = np.transpose(img_array, (1,2,0))
                if img_array.dtype != np.uint8:
                    img_array = ((img_array - np.nanmin(img_array)) / 
                                 np.nanmax(img_array - np.nanmin(img_array)) * 255).astype(np.uint8)
                st.image(img_array, use_column_width=True)
        except Exception as e:
            st.error(f"Cannot display image: {e}")
    else:
        st.info("No image uploaded yet.")
