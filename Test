// =========================
// üîπ STEP 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
// =========================
// ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏≤‡∏î (‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà) ‡∏ß‡∏≤‡∏î polygon ‡∏´‡∏£‡∏∑‡∏≠ rectangle ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô 'geometry'
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
// var geometry = ee.Geometry.Polygon([[[100.523, 13.736], [100.526, 13.736], [100.526, 13.734], [100.523, 13.734]]]);

// =========================
// üîπ STEP 2: ‡∏î‡∏∂‡∏á‡∏†‡∏≤‡∏û Sentinel-2
// =========================
var s2 = ee.ImageCollection('COPERNICUS/S2_SR_HARMONIZED')
  .filterBounds(geometry)                       // ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏î‡πÑ‡∏ß‡πâ
  .filterDate('2025-01-01', '2025-01-31')      // ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
  .filter(ee.Filter.lt('CLOUDY_PIXEL_PERCENTAGE', 10))  // ‡∏Å‡∏£‡∏≠‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏Ü‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 10%
  .median()                                    // ‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  .select(['B2', 'B3', 'B4', 'B8']);           // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ô‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

// =========================
// üîπ STEP 3: ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
// =========================
Map.centerObject(geometry, 13);
Map.addLayer(s2, {min: 0, max: 3000, bands: ['B4', 'B3', 'B2']}, 'Sentinel-2 RGB');

// =========================
// üîπ STEP 4: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
// =========================
var meanDict = s2.reduceRegion({
  reducer: ee.Reducer.mean(),
  geometry: geometry,
  scale: 10,          // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î 10 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•
  bestEffort: true
});

// =========================
// üîπ STEP 5: ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô Console
// =========================
print('‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡πÅ‡∏™‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ö‡∏ô‡∏î‡πå (√ó10000):', meanDict);

// ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ reflectance ‡∏à‡∏£‡∏¥‡∏á (0‚Äì1)
var trueReflectance = ee.Dictionary(meanDict).map(function(k, v) {
  return ee.Number(v).divide(10000);
});
print('‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ reflectance (0‚Äì1):', trueReflectance);
