<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite Time Machine</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        height: 100vh;
        overflow: hidden;
    }

    #map {
        width: 100%;
        height: 100vh;
    }

    .controls {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        min-width: 280px;
    }

    .controls h2 {
        font-size: 18px;
        margin-bottom: 15px;
        color: #333;
    }

    .control-group {
        margin-bottom: 15px;
    }

    .control-group label {
        display: block;
        font-size: 13px;
        color: #666;
        margin-bottom: 5px;
        font-weight: 500;
    }

    .control-group input[type="date"] {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s;
    }

    .control-group input[type="date"]:focus {
        outline: none;
        border-color: #4CAF50;
    }

    .btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
        transform: translateY(0);
    }

    .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
    }

    .info {
        margin-top: 15px;
        padding: 12px;
        background: #f5f5f5;
        border-radius: 6px;
        font-size: 12px;
        color: #666;
        line-height: 1.5;
    }

    .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 20px 40px;
        border-radius: 8px;
        z-index: 2000;
        display: none;
    }

    .loading.active {
        display: block;
    }

    .current-date {
        margin-top: 10px;
        padding: 10px;
        background: #e8f5e9;
        border-radius: 6px;
        font-size: 13px;
        color: #2e7d32;
        text-align: center;
        font-weight: 500;
    }

    .message-box {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        z-index: 2001;
        display: none;
        text-align: center;
        max-width: 400px;
    }

    .message-box.active {
        display: block;
    }

    .message-box h3 {
        color: #ff6b6b;
        margin-bottom: 15px;
        font-size: 20px;
    }

    .message-box p {
        color: #666;
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .message-box button {
        padding: 10px 30px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
    }

    .message-box button:hover {
        background: #5568d3;
    }

    @media (max-width: 768px) {
        .controls {
            top: 10px;
            right: 10px;
            left: 10px;
            min-width: auto;
        }
    }
</style>
```

</head>
<body>
    <div id="map"></div>
    <div class="loading" id="loading">Loading satellite imagery...</div>

```
<div class="message-box" id="messageBox">
    <h3>‚ö†Ô∏è No Image Available</h3>
    <p id="messageText">Don't have image yet, sorry. Please try a different date or location.</p>
    <button onclick="closeMessage()">OK</button>
</div>

<div class="controls">
    <h2>üõ∞Ô∏è Satellite Time Machine</h2>
    
    <div class="control-group">
        <label for="dateInput">Select Date:</label>
        <input type="date" id="dateInput" min="2017-01-01" max="2025-09-30">
    </div>
    
    <button class="btn" id="updateBtn" onclick="updateSatelliteImage()">Update Imagery</button>
    
    <div class="current-date" id="currentDate">
        Current: Latest Available
    </div>
    
    <div class="info">
        üìç Pan and zoom the map to explore<br>
        üìÖ Landsat 8 data from 2017 onwards<br>
        ‚è±Ô∏è Images update every 16 days<br>
        ‚òÅÔ∏è May show "no image" if unavailable
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let map = L.map('map').setView([37.7749, -122.4194], 10);

    let baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        opacity: 0.3
    }).addTo(map);

    let satelliteLayer = null;
    let currentDate = new Date().toISOString().split('T')[0];
    let tilesLoaded = 0;
    let tilesErrored = 0;
    let loadingTimeout = null;

    document.getElementById('dateInput').value = currentDate;
    document.getElementById('dateInput').max = currentDate;

    function showMessage(message) {
        document.getElementById('messageText').textContent = message;
        document.getElementById('messageBox').classList.add('active');
        document.getElementById('loading').classList.remove('active');
    }

    function closeMessage() {
        document.getElementById('messageBox').classList.remove('active');
    }

    function updateSatelliteImage() {
        const dateInput = document.getElementById('dateInput').value;
        if (!dateInput) {
            alert('Please select a date');
            return;
        }

        document.getElementById('loading').classList.add('active');
        document.getElementById('updateBtn').disabled = true;
        tilesLoaded = 0;
        tilesErrored = 0;

        if (satelliteLayer) {
            map.removeLayer(satelliteLayer);
        }

        // Using USGS Landsat 8 imagery via ArcGIS REST service
        // This provides actual dated imagery
        const year = dateInput.substring(0, 4);
        const month = dateInput.substring(5, 7);
        const day = dateInput.substring(8, 10);

        // Option 1: Use Planet Labs API (free tier available)
        // Option 2: Use Mapbox Satellite with dates
        // Option 3: Use USGS Earth Explorer Landsat
        
        // Using a combination approach with Landsat 8
        const landsatUrl = `https://services.arcgisonline.com/arcgis/rest/services/Landsat/MS/ImageServer/exportImage?` +
            `bbox={bbox-epsg-3857}&` +
            `bboxSR=3857&` +
            `size=256,256&` +
            `imageSR=3857&` +
            `time=${new Date(dateInput).getTime()},${new Date(dateInput).getTime() + 86400000}&` +
            `format=png&` +
            `pixelType=U8&` +
            `interpolation=RSP_BilinearInterpolation&` +
            `compression=&` +
            `compressionQuality=&` +
            `bandIds=&` +
            `mosaicRule=&` +
            `renderingRule=&` +
            `f=image`;

        satelliteLayer = L.tileLayer(landsatUrl, {
            attribution: '¬© USGS Landsat',
            maxZoom: 18,
            tileSize: 256,
            errorTileUrl: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'
        });

        let tileLoadCheck = 0;
        const maxTileCheck = 15;

        satelliteLayer.on('tileload', function() {
            tilesLoaded++;
            tileLoadCheck++;
            
            if (tileLoadCheck >= 5) {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('updateBtn').disabled = false;
                document.getElementById('currentDate').textContent = `Current: ${dateInput}`;
            }
        });

        satelliteLayer.on('tileerror', function() {
            tilesErrored++;
            tileLoadCheck++;
            
            if (tilesErrored >= 10 || tileLoadCheck >= maxTileCheck) {
                if (satelliteLayer) {
                    map.removeLayer(satelliteLayer);
                }
                
                showMessage(`Don't have image yet, sorry. The satellite may not have captured imagery for ${dateInput} at this location. Try a different date (images available every 16 days) or zoom to a different area.`);
                document.getElementById('updateBtn').disabled = false;
                document.getElementById('currentDate').textContent = `No image for: ${dateInput}`;
            }
        });

        satelliteLayer.addTo(map);

        // Fallback timeout
        clearTimeout(loadingTimeout);
        loadingTimeout = setTimeout(() => {
            if (tilesLoaded < 3) {
                if (satelliteLayer) {
                    map.removeLayer(satelliteLayer);
                }
                showMessage(`Don't have image yet, sorry. No imagery available for this date and location. Please try:\n\n‚Ä¢ A more recent date\n‚Ä¢ Different location (pan/zoom map)\n‚Ä¢ Date from 2017 onwards`);
                document.getElementById('currentDate').textContent = `No image available`;
            } else {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('currentDate').textContent = `Current: ${dateInput}`;
            }
            document.getElementById('updateBtn').disabled = false;
        }, 8000);
    }

    updateSatelliteImage();

    document.getElementById('dateInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            updateSatelliteImage();
        }
    });

    map.on('click', function(e) {
        console.log(`Location: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`);
    });
</script>
```

</body>
</html>
