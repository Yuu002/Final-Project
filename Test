import rasterio
import numpy as np

with rasterio.open(raster_path) as src:
    transform = src.transform
    width, height = src.width, src.height
    # แปลงพิกัด center -> row/col
    col, row = ~transform * (x_center, y_center)
    row, col = int(row), int(col)

    # เช็คว่า row/col อยู่ใน bounds
    if not (0 <= row < height and 0 <= col < width):
        raise ValueError("The specified coordinate is outside the raster extent.")

    # ดึงค่าตาม window รอบ pixel
    half_w = int(width_m / src.res[0] / 2)
    half_h = int(height_m / src.res[1] / 2)
    r0, r1 = max(0, row-half_h), min(height, row+half_h)
    c0, c1 = max(0, col-half_w), min(width, col+half_w)
    data_window = src.read(window=((r0,r1),(c0,c1)))
    # ถ้าไม่มีค่า data, คืน np.nan
    if data_window.size == 0:
        bands_mean = [np.nan]*src.count
