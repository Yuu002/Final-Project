def run_pipeline(lat, lon):
    bands = get_sentinel_data(lat, lon)
    
    # ส่ง DN ตรงๆ ไม่ต้องแปลง
    dn_red = bands["dn_red"]
    dn_nir = bands["dn_nir"]

    # indices และ AGB จะยังคงใช้ DN เหมือนกัน
    indices = calculate_indices(dn_red, dn_nir)

    X = [[indices["NDVI"], indices["TNDVI"], indices["SR"], indices["SAVI"], indices["MSAVI2"]]]
    X_scaled = scaler_svr_X.transform(X)

    agb = svr_agb.predict(X_scaled)[0]

    return {
        "lat": lat,
        "lon": lon,
        "dn_red": dn_red,
        "dn_nir": dn_nir,
        "indices": indices,
        "AGB": float(agb)
    }

--
def get_sentinel_data(lat, lon):
    # mock DN raw ของ pixel
    dn_red = 58    # ตัวอย่าง DN ของ Red band
    dn_nir = 60    # ตัวอย่าง DN ของ NIR band

    return {
        "dn_red": dn_red,
        "dn_nir": dn_nir
    }
