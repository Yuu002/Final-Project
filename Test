Client ID: 5fe79f43-3c2d-4cf6-9184-478e247504b7
Client secret: uYQ6E6NvUDucLx0yRqz4zrUyeuWcX09U

import os
import requests
from typing import Dict

def get_access_token(client_id: str, client_secret: str) -> str:
    """ขอ access token จาก Sentinel Hub OAuth"""
    url = "https://services.sentinel-hub.com/oauth/token"
    data = {
        "grant_type":"client_credentials",
        "client_id": client_id,
        "client_secret": client_secret
    }
    r = requests.post(url, data=data)
    r.raise_for_status()
    return r.json()["access_token"]

def fetch_bands_from_sentinelhub(lat: float, lng: float, instance_id: str) -> Dict[str,int]:
    """
    ดึง bands จาก Sentinel Hub WMS/WMTS
    คืนค่า integer scaled-by-100
    """
    # อ่าน Client ID / Secret จาก env
    client_id = os.getenv("SENTINELHUB_CLIENT_ID")
    client_secret = os.getenv("SENTINELHUB_CLIENT_SECRET")
    if not client_id or not client_secret:
        raise ValueError("SENTINELHUB_CLIENT_ID / SECRET ต้องตั้งค่าใน env")

    token = get_access_token(client_id, client_secret)

    # สร้าง WMS GetMap request
    wms_url = f"https://services.sentinel-hub.com/ogc/wms/{instance_id}"
    params = {
        "SERVICE": "WMS",
        "REQUEST": "GetMap",
        "LAYERS": "TRUE_COLOR",   # หรือ custom layer
        "MAXCC": 20,
        "WIDTH": 1,
        "HEIGHT": 1,
        "CRS": "EPSG:4326",
        "BBOX": f"{lng},{lat},{lng},{lat}",  # single pixel
        "FORMAT": "image/tiff",
        "TIME": "2023-01-01/2023-12-31"
    }
    headers = {"Authorization": f"Bearer {token}"}

    r = requests.get(wms_url, headers=headers, params=params)
    r.raise_for_status()

    # อ่านค่า pixel จาก response (TIFF) 
    # TODO: ต้องใช้ rasterio / PIL / numpy เพื่ออ่าน band values
    # ตอนนี้ placeholder
    # แปลงเป็น integer scaled-by-100
    bands_int = {
        "red": 43,
        "green": 38,
        "blue": 35,
        "nir": 57,
        "swir": 23
    }

    return bands_int
